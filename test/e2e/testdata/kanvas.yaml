components:
  product1:
    components:
      appimage:
        dir: /
        docker:
          file: containerimages/app/Dockerfile
          image: "mumoshu/example:myownprefix-"
      base:
        dir: /terraform/base
        needs:
        - appimage
        terraform:
          target: null_resource.eks_cluster
          vars:
          - name: name
            value: mycluster
          - name: vpc_name
            value: myvpc
      eks:
        dir: /terraform/eks
        needs:
        - appimage
        terraform:
          vars:
          - name: name
            value: mycluster2
          - name: vpc_name
            value: myvpc
          - name: region
            value: ap-northeast-1
      argocd:
        dir: /terraform/argocd
        needs:
        - base
        terraform:
          target: null_resource.argocd
          vars:
          - name: cluster_endpoint
            valueFrom: base.cluster_endpoint
          - name: cluster_token
            valueFrom: base.cluster_token
      argocd_app:
        needs:
        - appimage
        - argocd
        kubernetes:
          repo: github.com/mumoshu/kanvas-example
          path: e2e
          argocd:
            imageFrom: appimage.id
            serverFrom: argocd.argocd_server
            usernameFrom: argocd.argocd_username
            passwordFrom: argocd.argocd_password
            insecureFrom: argocd.argocd_insecure
